<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏°</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    h2 { margin-bottom: 10px; }
    .section { margin-top: 30px; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background-color: #f0f0f0; }
    .back-btn { margin-top: 30px; padding: 10px 20px; }
    .total-row { text-align: right; font-weight: bold; padding-top: 10px; }
  </style>
</head>
<body>

  <h2>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h2>

  <div class="section">
    <h3>üìå ‡∏≠‡∏≠‡∏°‡∏õ‡∏£‡∏∞‡∏à‡∏≥</h3>
    <table id="fixedTable">
      <thead>
        <tr>
          <th>‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢</th>
          <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏ö‡∏≤‡∏ó)</th>
          <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <p class="total-row" id="fixedTotal"></p>
  </div>

  <div class="section">
    <h3>üéØ ‡∏≠‡∏≠‡∏°‡∏°‡∏µ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢</h3>
    <table id="goalTable">
      <thead>
        <tr>
          <th>‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢</th>
          <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏Å‡πá‡∏ö‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô (‡∏ö‡∏≤‡∏ó)</th>
          <th>‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤ (‡∏ß‡∏±‡∏ô)</th>
          <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <p class="total-row" id="goalTotal"></p>
  </div>

  <button class="back-btn" onclick="goBack()">üîô ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏≠‡∏≠‡∏°</button>

  <script>
    const sheetURL = "https://sheetdb.io/api/v1/nlnc03ay4ibgj";
    const currentUser = localStorage.getItem("username");

    if (!currentUser) {
      alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô");
      window.location.href = "checkin.html";
    }

    fetch(`${sheetURL}?UserID=${currentUser}`)
      .then(res => res.json())
      .then(data => {
        const fixedTable = document.getElementById("fixedTable").querySelector("tbody");
        const goalTable = document.getElementById("goalTable").querySelector("tbody");
        const fixedTotalText = document.getElementById("fixedTotal");
        const goalTotalText = document.getElementById("goalTotal");

        const fixedData = data.filter(d => d.‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó === "‡∏≠‡∏≠‡∏°‡∏õ‡∏£‡∏∞‡∏à‡∏≥");
        const goalData = data.filter(d => d.‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó === "‡∏≠‡∏≠‡∏°‡∏°‡∏µ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢");

        let fixedTotal = 0;
        if (fixedData.length === 0) {
          fixedTable.innerHTML = `<tr><td colspan="3">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>`;
        } else {
          fixedData.forEach(row => {
            const amount = parseFloat(row['‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏°‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ'] || 0);
            fixedTotal += amount;
            fixedTable.innerHTML += `
              <tr>
                <td>${row['‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢']}</td>
                <td>${amount.toLocaleString()}</td>
                <td>${row.Date || '-'}</td>
              </tr>
            `;
          });
          fixedTotalText.innerText = `‡∏£‡∏ß‡∏°‡∏≠‡∏≠‡∏°‡∏õ‡∏£‡∏∞‡∏à‡∏≥: ${fixedTotal.toLocaleString()} ‡∏ö‡∏≤‡∏ó`;
        }

        let goalTotal = 0;
        if (goalData.length === 0) {
          goalTable.innerHTML = `<tr><td colspan="4">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>`;
        } else {
          goalData.forEach(row => {
            const amount = parseFloat(row['‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Å‡πá‡∏ö‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£'] || 0);
            goalTotal += amount;
            goalTable.innerHTML += `
              <tr>
                <td>${row['‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢']}</td>
                <td>${parseFloat(row['‡∏¢‡∏≠‡∏î‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô'] || 0).toLocaleString()}</td>
                <td>${row['‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö']}</td>
                <td>${row.Date || '-'}</td>
              </tr>
            `;
          });
          goalTotalText.innerText = `‡∏£‡∏ß‡∏°‡∏≠‡∏≠‡∏°‡∏°‡∏µ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢: ${goalTotal.toLocaleString()} ‡∏ö‡∏≤‡∏ó`;
        }
      })
      .catch(err => {
        console.error(err);
        alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‚ùå");
      });

    function goBack() {
      window.location.href = "self-saving.html"; // ‡∏´‡∏£‡∏∑‡∏≠‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡∏´‡∏ô‡πâ‡∏≤‡∏≠‡∏≠‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
    }
  </script>

</body>
</html>